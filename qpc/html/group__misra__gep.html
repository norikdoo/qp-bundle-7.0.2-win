<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QP/C: Guideline Enforcement Plan (GEP)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="ql-preview.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    QP/C
    &nbsp;<span id="projectnumber">7.0.2</span>
   </div>
   <div id="projectbrief">Real-Time Embedded Framework</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__misra__gep.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Guideline Enforcement Plan (GEP)<div class="ingroups"><a class="el" href="group__misra.html">MISRA Compliance</a></div></div></div>
</div><!--header-->
<div class="contents">
<p ><span class="prev_button"><a class="el" href="group__misra.html">MISRA Compliance</a></span><span class="next_button"><a class="el" href="group__misra__gcs.html">Guideline Compliance Summary (GCS)</a></span></p>
<p >As recommended in <a class="el" href="group__misra.html#misra_ref">[MISRA2-Comp]</a>, this section presents the MISRA Guideline Enforcement Plan (GEP). The plan presented here is centered on automatic guideline enforcement of as many rules as possible by means of a <b>static analysis tool</b>, which is stipulated by <a class="el" href="group__misra.html#misra_ref">[MISRA3]</a>, Section 3.2 "Analysis tools".</p>
<dl class="section note"><dt>Note</dt><dd>The completely automatic enforcement of 100% of the MISRA-C rules is not possible and was never intended. Some of the rules are only enforceable by manual review of the code or checking the compiler/linker tools by other means.</dd></dl>
<h1><a class="anchor" id="misra_ctxt"></a>
Contextual Rule Suppression</h1>
<dl class="section attention"><dt>Attention</dt><dd>This Guideline Enforcement Plan uses the <b>contextual rule suppression</b> as the most important, central principle. It means that the static analysis tool is configured to suppress diagnostics from known deviations <em>only</em> in a specific, well defined context in which the deviation is permitted. Otherwise, a given MISRA guideline remains in full force and gets checked in all other contexts.</dd></dl>
<h1><a class="anchor" id="misra_pclp"></a>
PC-lint Plus Static Analysis Tool</h1>
<p >This Guideline Enforcement Plan uses <a href="https://www.vector.com/us/en/products/products-a-z/software/pc-lint-plus" class="extern" target="_blank" title="PC-Lint-Plus"><b>PC-Lint-Plus</b></a>, which is a static analysis tool for C and C++ with one of the longest track records and best value of the money in the industry. PC-Lint family of tools have been supporting checks for the MISRA-C guidelines since early 2001, and the company behind the tool is committed to provide ongoing and increasing support for these guidelines.</p>
<p ><a href="https://www.vector.com/us/en/products/products-a-z/software/pc-lint-plus"><div class="image">
<img src="pc-lint-plus.png" alt=""/>
<div class="caption">
PC-Lint Plus</div></div>
     </a></p>
<h2><a class="anchor" id="misra_pclp-m3"></a>
Analysis Scope in PCLP</h2>
<p >The primary way of activating checking for MISRA-C:2012 guidelines in PC-int Plus is via the following configuration files:</p>
<ul>
<li><code>au-misra3.lnt</code> &mdash; checking <a class="el" href="group__misra.html#misra_ref">[MISRA3]</a></li>
<li><code>au-misra3-amd1.lnt</code> &mdash; checking <a class="el" href="group__misra.html#misra_ref">[MISRA3-A1]</a></li>
<li><code>au-misra3-amd2.lnt</code> &mdash; checking <a class="el" href="group__misra.html#misra_ref">[MISRA3-A2]</a></li>
</ul>
<p >The level of support provided by PC-lint Plus for each of the corresponding MISRA-C:2012 guidelines is described in the following sections of the <a class="el" href="group__misra.html#misra_ref">[PCLP] PC-lint Plus User Manual</a>.</p>
<ul>
<li>11.1.2 MISRA C 2012 Guideline Support Matrix</li>
<li>11.2.2 MISRA C 2012 AMD-1 Guideline Support Matrix</li>
<li>11.3.2 MISRA C 2012 AMD-2 Guideline Support Matrix</li>
</ul>
<h2><a class="anchor" id="misra_pclp-config"></a>
Configuring PC-lint Plus</h2>
<p >PC-lint Plus has several places where it reads its currently valid options:</p><ul>
<li>From special Lint option files (usually called <code>*.lnt</code>)</li>
<li>From the command line</li>
<li>From within the special lint-comments in the source code modules (not recommended)</li>
</ul>
<p >The QP/C source code and example application code has been “linted” only by means of the first alternative (option files) with possibility of adding options via command line. The third alternative (lint comments) is not used and Quantum Leaps does not recommend this alternative. (NOTE: The QP/C source code is completely free of lint comments, which are viewed as a contamination of the source code).</p>
<p >The structure of the PC-lint Plus option files used for “linting” QP/C follows exactly the published guidelines for configuring PC-lint Plus (See Section 3.2 “Configuration” in the PC-lint Plus Manual [10]. The design and grouping of the lint options also reflects the fact that static code analysis of a software framework, such as QP/C, has really two major aspects:</p>
<ul>
<li>The source code of the QP/C framework itself has to be analyzed.</li>
<li>But even more important and helpful to the users of the framework is providing the infrastructure to effectively analyze the <b>Application code</b> based on the framework.</li>
</ul>
<p >With this in mind, <a class="el" href="group__misra__gep.html#misra_l1">Listing 1</a> shows that the PC-lint Plus options are divided into two files options.lnt and qpc.lnt, located in directory <code>qpc/ports/lint-plus</code>. These two files are for analyzing QP/C source code and Application code, respectively.</p>
<p ><a class="anchor" id="misra_l1"></a></p><div class="caption" align="center">Listing 1: directories and files for “lining” QP/C code and Application code.</div><div class="fragment"><div class="line">&lt;qpc&gt;                           <span class="comment">// QP/C installation directory</span></div>
<div class="line">│</div>
<div class="line">├───include                     <span class="comment">// QP/C platform-independent includes</span></div>
<div class="line">│       qpc.h                   <span class="comment">// QP/C header file</span></div>
<div class="line">│       . . .</div>
<div class="line">│</div>
<div class="line">├───src                         <span class="comment">// QP/C platform-independent source code</span></div>
<div class="line">│   │</div>
<div class="line">│   ├───qf                      <span class="comment">// QEP/QF components of QP/C</span></div>
<div class="line">│   ├───qk                      <span class="comment">// QK component of QP/C</span></div>
<div class="line">│   ├───qs                      <span class="comment">// QS component of QP/C</span></div>
<div class="line">│   ├───qv                      <span class="comment">// QV component of QP/C</span></div>
<div class="line">│   ├───qxk                     <span class="comment">// QXK component of QP/C</span></div>
<div class="line">│</div>
<div class="line">├───ports                       <span class="comment">// QP/C ports directory</span></div>
<div class="line">│   │</div>
<div class="line">│   ├───lint-plus               <span class="comment">// QP/C “port” to PC-lint Plus</span></div>
<div class="line">│   │   ├───16bit               <span class="comment">// QP/C “port” to 16-bit CPU</span></div>
<div class="line">│   │   │       cpu.lnt         <span class="comment">// Sizes of integers and pointers for a 16-bit CPU</span></div>
<div class="line">│   │   │       qs_port.h       <span class="comment">// QS  component “port” to a generic 16-bit CPU</span></div>
<div class="line">│   │   │       stdint.h        <span class="comment">// Standard exact-width integers for a 16-bit CPU</span></div>
<div class="line">│   │   │</div>
<div class="line">│   │   ├───32bit</div>
<div class="line">│   │   │       cpu.lnt         <span class="comment">// Sizes of integers and pointers for a 32-bit CPU</span></div>
<div class="line">│   │   │       qs_port.h       <span class="comment">// QS  component “port” to a generic 32-bit CPU</span></div>
<div class="line">│   │   │       stdint.h        <span class="comment">// Standard exact-width integers for a 32-bit CPU</span></div>
<div class="line">│   │   │</div>
<div class="line">│   │   ├───qk                  <span class="comment">// QP/C “port” to QK real-time kernel</span></div>
<div class="line">│   │   │       qf_port.h</div>
<div class="line">│   │   │       qk_port.h</div>
<div class="line">│   │   │</div>
<div class="line">│   │   ├───qv                  <span class="comment">// QP/C “port” to QV real-time kernel</span></div>
<div class="line">│   │   │       qf_port.h</div>
<div class="line">│   │   │       qv_port.h</div>
<div class="line">│   │   │</div>
<div class="line">│   │   ├───qxk                 <span class="comment">// QP/C “port” to QXK real-time kernel</span></div>
<div class="line">│   │   │       qf_port.h</div>
<div class="line">│   │   │       qs_port.h</div>
<div class="line">│   │   │       qxk_port.h</div>
<div class="line">│   │   │</div>
<div class="line">│   │   │   au-ds.lnt           <span class="comment">// Dan Saks recommendations</span></div>
<div class="line">│   │   │   au-misra3-amd1.lnt  <span class="comment">// MISRA-C:2012 - Amendment 1 compliance options</span></div>
<div class="line">│   │   │   au-misra3-amd2.lnt  <span class="comment">// MISRA-C:2012 - Amendment 2 compliance options</span></div>
<div class="line">│   │   │   au-misra3.lnt       <span class="comment">// MISRA-C:2012 compliance options</span></div>
<div class="line">│   │   │</div>
<div class="line">│   │   │   lin.bat             <span class="comment">// Batch file to invoke PC-lint Plus to analyze QP/C</span></div>
<div class="line">│   │   │</div>
<div class="line">│   │   │   lint_qf.log         <span class="comment">// PC/Lint output for the QF component of QP/C</span></div>
<div class="line">│   │   │   lint_qk.log         <span class="comment">// PC/Lint output for the QK component of QP/C</span></div>
<div class="line">│   │   │   lint_qs.log         <span class="comment">// PC/Lint output for the QS component of QP/C</span></div>
<div class="line">│   │   │   lint_qv.log         <span class="comment">// PC/Lint output for the QV component of QP/C</span></div>
<div class="line">│   │   │   lint_qxk.log        <span class="comment">// PC/Lint output for the QXK component of QP/C</span></div>
<div class="line">│   │   │</div>
<div class="line">│   │   │   options.lnt         <span class="comment">// PC/Lint options for “linting” QP/C source code</span></div>
<div class="line">│   │   │   qpc.lnt             <span class="comment">// PC-lint Plus options for QP/C Applications</span></div>
<div class="line">│   │   │   std.lnt             <span class="comment">// Standard PC-lint Plus settings</span></div>
<div class="line">│   │   │</div>
<div class="line">│   │   │   qep_port.h          <span class="comment">// QEP component “port” to a generic C99 compiler</span></div>
<div class="line">│   │   │   stdbool.h           <span class="comment">// Standard Boolean type</span></div>
<div class="line">│</div>
<div class="line">├───examples                    <span class="comment">// QP/C examples directory (Applications)</span></div>
<div class="line">│   │</div>
<div class="line">│   ├───arm-cm                  <span class="comment">// QP/C examples for ARM Cortex-M</span></div>
<div class="line">│   │   ├───dpp_ek-tm4c123gxl   <span class="comment">// DPP example on the EK-TM4C123GLX board</span></div>
<div class="line">│   │   │   ├───lint-plus       <span class="comment">// directory for linting the application</span></div>
<div class="line">│   │   │   │       lin.bat     <span class="comment">// Batch to run PC-lint Plus analysis of Application code</span></div>
<div class="line">│   │   │   │       options.lnt <span class="comment">// PC-lint Plus options for “linting” of Application code</span></div>
<div class="line">│   │</div>
<div class="line">│   ├─── . . .                  <span class="comment">// Other examples...</span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Please note that the <code>&lt;qpc&gt;/ports/lint-plus</code> directory contains all PC-lint Plus option files used in “linting” the code, including the standard MISRA-C:2012 <code>au-misr3.lnt</code>, <code>au-misr3-amd1.lnt</code>, and <code>au-misr3-amd2.lnt</code> option files as well as Dan Saks' recommendations au-ds.lnt, which are copied from the PC-lint Plus distribution. This design freezes the lint options for which the compliance has been checked.</dd></dl>
<h2><a class="anchor" id="misra_pclp-std"></a>
The std.lnt option file</h2>
<p >According to the PC-lint Plus configuration guidelines, the file std.lnt file contains the top-level options, which Quantum Leaps recommends for all projects. These options include the formatting of the PC-lint Plus messages and making two passes to perform better cross-module analysis. However, the most important option is -restore_at_end, which has the effect of surrounding each source file with options -save and -restore. This precaution prevents options from “bleeding” from one file to another.</p>
<h2><a class="anchor" id="misra_pclp-qpc"></a>
The qpc.lnt option file</h2>
<p >The most important file for “linting” QP/C applications is the qpc.lnt option file. This file handles all deviations from the MISRA-C:2012 rules, which might arise at the application-level code from the use of the QP/C framework. In other words, the qpc.lnt option file allows completely clean “linting” of the application-level code, as long as the application code does not violate any of the MISRA-C:2012 rules.</p>
<p >At the same time, the qpc.lnt option file has been very carefully designed not to suppress any MISRA-C:2012 rule checking outside the very specific context of the QP/C API. In other words, the qpc.lnt option file still supports 100% of the MISRA-C:2012 rule checks that PC-lint Plus is capable of performing.</p>
<p >For example, for reasons explained in Section 5.10, QP/C extensively uses function-like macros, which deviates from the MISRA-C:2012 advisory rule 19.7 and which PC-lint Plus checks with the warning 961. However, instead of suppressing this warning globally (with the <code>-e961</code> directive), the qpc.lnt option file suppresses warning 961 only for the specific QP function-like macros that are visible to the application level. So specifically, the qpc.lnt file contains directives <code>-estring(961, Q_TRAN, Q_SPUER, ...)</code>, which suppresses the warning only for the specified macros, but does not disable checking of any other macros in the application-level code.</p>
<h1><a class="anchor" id="misra_qpc"></a>
Compliance of QP/C Source Code</h1>
<p >The directory `<code>&lt;qpc&gt;/ports/lint-plus</code> (see <a class="el" href="group__misra__gep.html#misra_l1">Listing 1</a>) contains also the <code>lin.bat</code> batch file for “linting” the QP/C source code. The <code>lin.bat</code> batch file invokes PC-lint Plus and stores the lint output files. As shown in <a class="el" href="group__misra__gep.html#misra_l1">Listing 1</a>, the lint output is collected into four text files <code>lint_qf.log</code>, <code>lint_qk.log</code>, lint_qv.log<code>, lint_qxk.log</code> and <code>lint_qs.log</code>, for <a class="el" href="struct_q_f.html" title="QF active object framework.">QF</a>, <a class="el" href="struct_q_k.html" title="QK preemptive non-blocking kernel.">QK</a>, <a class="el" href="struct_q_x_k.html" title="The QXK kernel class.">QXK</a>, and QS components of the QP/C framework, respectively.</p>
<blockquote class="doxtable">
<p >&zwj;NOTE: In order to execute the <code>lin.bat</code> file on your system, you might need to adjust the symbol <code>PC_LINT_DIR</code> at the top of the batch file, to the PC-lint Plus installation directory on your computer. </p>
</blockquote>
<p>The <code>lin.bat</code> batch file invoked without any command-line options checks the code in the default configuration corresponding to Run or Debug build of a project. But the <code>lin.bat</code> batch can also be invoked with the option <code>-dQ_SPY</code> to check the QP/C code in the <em>Spy</em> build configuration with software tracing.</p>
<h2><a class="anchor" id="misra_qspy"></a>
QS Software Tracing</h2>
<p >As described in Chapter 11 of the book “Practical UML Statecharts in C/C++” <a class="el" href="group__misra.html#misra_ref">[PSiCC2]</a>, all the QP/C framework contains <b>software tracing instrumentation</b> (called <a href="https://www.state-machine.com/products/qtools#QPSpy" class="extern" target="_blank">QP/Spy</a>). This instrumentation code is inactive in the Debug and Release build configurations, but becomes active in the Spy configuration (macro <a class="el" href="config_8h.html#a668b5df6d955d0b1c77227192078689b">Q_SPY</a> defined).</p>
<p >In the context of MISRA-C compliance it is important to note that, by the nature of software tracing, the QS instrumentation embedded in the QP/C framework contributes disproportionately to the total number of deviations from the MISRA-C rules, both in the QP/C source code and in the application-level code. However, these deviations occur only in the Spy build configuration, which typically is <em>not</em> the code shipped within a product.</p>
<dl class="section note"><dt>Note</dt><dd>Many of the deviations from the MISRA-C:2012 rules reported in the upcoming <a class="el" href="group__misra__gcs.html">Guideline Compliance Summary (GCS)</a> do not pertain to the production code.</dd></dl>
<p>NOTE: By the nature of software tracing, the Q_SPY configuration transgresses many more MISRA-C rules than the standard configuration. However, the Q_SPY configuration is seldom used for production code, so the MISRA-C compliance of the QP/C framework should not be judged by the deviations that happen only in the Q_SPY configuration.</p>
<p >According to the PC-lint Plus guidelines, the <code>lin.bat</code> uses two option files: the <a class="el" href="group__misra__gep.html#misra_pclp-std">std.lnt</a> option file discussed before and the misra_pclp-opt "options.lnt" file covers all deviations from the MISRA-C rules in the QP/C source code. Section <a class="el" href="group__misra__gcs.html">Guideline Compliance Summary (GCS)</a> cross-references all these deviations, while Section misra_dev describes the reasons for deviations in those, very specific contexts.</p>
<h1><a class="anchor" id="misra_app"></a>
Compliance of Application Code</h1>
<p >The QP/C baseline code (for versions QP/C 6.9.0 and higher) contains an example of MISRA-C compliance checking with PC-lint Plus:</p>
<ul>
<li>The DPP example for the EK-TM4C123GLX Cortex-M4F board, located in the directory <code>&lt;qpc&gt;/examples/arm-cm/dpp_ek-tm4c123gxl/lint-plus</code>;</li>
</ul>
<p >The PC-lint Plus analysis is very simple and requires invoking the <code>lin.bat</code> file from the lint/ sub-directory.</p>
<blockquote class="doxtable">
<p >&zwj;NOTE: In order to execute the <code>lin.bat</code> file on your system, you might need to adjust the symbol PC_LINT_DIR at the top of the batch file, to the PC-lint Plus installation directory on your computer. You </p>
</blockquote>
<p>The <code>lint-plus</code> subdirectory in each of the application folders contains also the <code>options.lnt</code> with the PC-lint Plus options specific to linting the application.</p>
<p >Running PC-lint Plus on embedded projects (such as the DPP example for ARM Cortex-M) requires option files for the specific compilers (co-iar-arm.lnt file for IAR ARM and co-gnu-arm.lnt file GNU ARM, respectively). These option files are provided in the QTools collection. The location of the QTools directory in your system is specified in the <code>options.lnt</code> file, and you most likely need to adjust it for your system.</p>
<dl class="section note"><dt>Note</dt><dd>The QTools collection is available for a separate download from <a href="https://github.com/QuantumLeaps/qtools">https://github.com/QuantumLeaps/qtools</a>. Quantum Leaps is committed to keep adding more and more PC-lint Plus option files for various embedded C/C++ cross-compilers in the QTools collection.</dd></dl>
<p><br  />
 <span class="prev_button"><a class="el" href="group__misra.html">MISRA Compliance</a></span><span class="next_button"><a class="el" href="group__misra__gcs.html">Guideline Compliance Summary (GCS)</a></span> </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2022 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 7.0.2</b> &nbsp;|&nbsp; Updated on Sat Aug 13 2022
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2022 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QP/C 7.0.2</b> &nbsp;|&nbsp; Updated on Sat Aug 13 2022
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
